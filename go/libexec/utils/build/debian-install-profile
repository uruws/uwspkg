#!/bin/sh
set -eu

builddir=${1:?'build dir?'}
cfgdir=${2:?'config dir?'}
prof=${3:?'profile?'}

if test 'Xdefault' = "X${prof}"; then
	exit 0
fi

distro=$(cat ${cfgdir}/uwspkg-${prof}/debian.distro)

baseroot=${builddir}/chroot/debian/${distro}
dstroot=${builddir}/chroot/${prof}

rsync -ax --delete-before ${baseroot}/ ${dstroot}/
echo "uwspkg-${prof}" | tee ${dstroot}/etc/debian_chroot

exit 0
