#!/bin/sh
set -eu

builddir=${1:?'build dir?'}
cfgdir=${2:?'config dir?'}
dstdir=${3:?'config dest dir?'}

schroot_conf=${cfgdir}/chroot.d/uwspkg.conf

install -v -d -m 0755 ${builddir}/build
install -v -d -m 0755 ${builddir}/cache/debootstrap
install -v -d -m 0755 ${builddir}/union/overlay ${builddir}/union/underlay

install -v -d -m 0755 ${dstdir}/chroot.d

if ! test -s ${schroot_conf}; then
	echo "${schroot_conf}: file not found" >&2
	exit 1
fi

cfgtmp=$(mktemp /tmp/uwspkg-build-setup.XXXXXXXX)
cat ${schroot_conf} |
	sed "s#@BUILDDIR#${builddir}#g" >${cfgtmp}

install -v -C -m 0644 ${cfgtmp} ${dstdir}/chroot.d/uwspkg.conf
rm -f ${cfgtmp}

exit 0
