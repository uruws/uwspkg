#!/bin/sh
set -eu

builddir=${1:?'build dir?'}
cfgdir=${2:?'config dir?'}
dstdir=${3:?'config dest dir?'}
prof=${4:?'profile?'}

cfgdst=${dstdir}/uwspkg-${prof}
profcfg=${dstdir}/chroot.d/uwspkg-${prof}.conf
proftmp=$(mktemp /tmp/uwspkg-setup-profile.XXXXXXXX)

rm -rf ${cfgdst}

install -m 0755 -d ${cfgdst}
install -C -m 0644 ${cfgdir}/uwspkg-${prof}/* ${cfgdst}

cat ${cfgdir}/chroot.d/uwspkg-${prof}.conf |
	sed "s#@BUILDDIR@#${builddir}#g" >${proftmp}

install -v -C -m 0644 ${proftmp} ${profcfg}
rm -f ${proftmp}

exit 0
